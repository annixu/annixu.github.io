<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8" />
        <title>Global Religion in 65 years</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://unpkg.com/topojson@3"></script> 
        <link rel="stylesheet" href="globalReligion.css ">
        <script src="globalReligion.js"></script>
    </head>

    <body>  

            <div id='intro'>               
                <h1 id="title">Global Religion in 65 years</h1>              

                <p class="body">
                    This project looks into the progression of religious 
                    beliefs of people around the world over a span of 65 years.
                    The data is recorded since 1945 incrementally till 2010, 
                    and the data is credited to University of California-Davis, 
                    and Errol Henderson, Pennsylvania State University, and published 
                    by the Correlates of War Project. 
                </p>
                
                <p class="body">
                    For this project, I want to look at the trend of how religious
                    belief changed over time from 1945 to 2010 across the globe. 
                    The visualization will show the four biggest religions
                    (Christianity, Islam. Hinduism and Buddhism), together with 
                    all other religions and no religious beliefs.It would be interesting 
                    to see how changes happen most dramatically in five year increments.
                </p>  
            </div>

            <div class="container">

                <div id="buttons">
                    <svg display="inline", class="religionClass" height="100" width="800">

                        <text x="80%" y="20" fill="black" text-anchor="middle">Christian</text>
                        <circle class="C1" cx="80%" cy="70px" r="15px" />
        
                        <text x="90%" y="20" fill="black" text-anchor="middle">Islam</text>
                        <circle class="C2"cx="90%" cy="70px" r="15px" />
        
                        <text x="100%" y="20" fill="black" text-anchor="middle">Hinduism</text>
                        <circle class="C3"cx="100%" cy="70px" r="15px" />
        
                        <text x="110%" y="20" fill="black" text-anchor="middle">Buddhism</text>
                        <circle class="C4"cx="110%" cy="70px" r="15px" />
        
                        <text x="120%" y="20" fill="black" text-anchor="middle">Others</text>
                        <circle class="C5" cx="120%" cy="70px" r="15px" />
        
                        <text x="130%" y="20" fill="black" text-anchor="middle">None</text>
                        <circle class="C6"cx="130%" cy="70px" r="15px" />
                    </svg>                 
                </div>
                               
                <div id="map">
                    <svg display="inline" id="my-map"></svg>
                </div>

            
            </div>
            
        <script>
                var width = 2000;
                var height = 600;
                
                d3.queue()
                    .defer(d3.csv, "national_accurate.csv")
                    .defer(d3.json, "world-alpha3.json")
                    .awaitAll(function(error, dataArray) {
        
                    var data = dataArray[0];
                    data.forEach(function(d) {
                        d.christianity_all = parseFloat(d.christianity_all);
                        d.islam_all = parseFloat(d.islam_all)
                        d.hinduism_all = parseFloat(d.hinduism_all)
                        d.buddhism_all = parseFloat(d.buddhism_all)
                        d.otherreligion_all = parseFloat(d.otherreligion_all)
                        d.noreligion_all = parseFloat(d.noreligion_all)
                    });
                    
                    var latestData = data.filter(function(d) {
                        return d.year == "1945";
                    });
                    console.log(latestData)

                    var domain = d3.extent(latestData, function(d) {
                        return d.christianity_all;
                    });
                    var colorScale = d3.scaleLinear()
                        .domain(domain)
                        .range(["rgb(200, 150, 150)", "rgb(100, 0, 0)"]);
                    console.log(domain)
    
                    var countryTopojson = dataArray[1];
    
                // Removing Antarctica
                    var geoJSON = topojson.feature(countryTopojson, countryTopojson.objects.countries);
                    console.log(geoJSON);
                    geoJSON.features = geoJSON.features.filter(function(country) {
                    return country.id != "ATA" && country.id != "-99";
                    });
    
                    var projection = d3.geoMercator()
                        .fitSize([width, height], geoJSON);
    
                    var path = d3.geoPath()
                        .projection(projection);
    
                    var svg = d3.select("#my-map", display = "inline")

                        .attr("width", width + "px")
                        .attr("height", height + "px")
                        .attr("transform","scale(0.6)"); 
    
                    var countries = svg.selectAll("path")
                        .data(geoJSON.features)  
                        .enter().append("path")
                        .attr("d", function(feature) {
                            return path(feature);
                        })

         // match country id from the topoJSON onto my data 
                    .attr("fill", function(feature) {
                        var matches = latestData.filter(function(d) {
                            return d["Alpha-3"] == feature.id;
                        });
                        if (matches.length > 0) {
                            return colorScale(matches[0].christianity_all);
                        }
                        else {
                            return "rgb(200, 200, 200)";
                        }
                    }).on("mouseover",function() { })
    
        // On click for Christians
                    d3.select(".C1").on("click", function() {
                        var domain = d3.extent(latestData, function(d) {
                            return d.christianity_all;
                        });
                        var colorScale = d3.scaleLinear()
                            .domain(domain)
                            .range(["rgb(254,229,217)", "rgb(165,15,21)"]);

                        console.log(countries);
                        
                        countries.attr("fill", function(feature) {
                            var matches = latestData.filter(function(d) {
                                return d["Alpha-3"] == feature.id;
                            });
                            console.log(matches);
                            if (matches.length > 0) {
                                return colorScale(matches[0].christianity_all);
                            }
                            else {
                                return "rgb(200, 200, 200)";
                            }
                        })  
                    })

        // On click for Islam 
                        d3.select(".C2").on("click", function() {
                            var domain = d3.extent(latestData, function(d) {
                                return d.islam_all;
                            });
                            var colorScale = d3.scaleLinear()
                                .domain(domain)
                                .range(["rgb(199,233,192)", "rgb(0,109,44)"]);

                            console.log(countries);
                            
                            countries.attr("fill", function(feature) {
                                var matches = latestData.filter(function(d) {
                                    return d["Alpha-3"] == feature.id;
                                });
                                if (feature.id == "RUS"){
                                    console.log(matches);
                                } 
                                if (matches.length > 0) {
                                    return colorScale(matches[0].islam_all);
                                }
                                else {
                                    return "rgb(200, 200, 200)";
                                }
                            })
                        });

        // On click for Hinduism
                        d3.select(".C3").on("click", function() {
                            var domain = d3.extent(latestData, function(d) {
                                return d.hinduism_all;
                            });
                            var colorScale = d3.scaleLinear()
                                .domain(domain)
                                .range(["rgb(254,227,145)", "rgb(217,95,14)"]);

                            console.log(countries);
                            
                            countries.attr("fill", function(feature) {
                                var matches = latestData.filter(function(d) {
                                    return d["Alpha-3"] == feature.id;
                                });
                                console.log(matches);
                                if (matches.length > 0) {
                                    return colorScale(matches[0].hinduism_all);
                                }
                                else {
                                    return "rgb(200, 200, 200)";
                                }
                            })
                        });
                        
        // On click for Buddhism
                        d3.select(".C4").on("click", function() {
                            var domain = d3.extent(latestData, function(d) {
                                return d.buddhism_all;
                            });
                            var colorScale = d3.scaleLinear()
                                .domain(domain)
                                .range(["rgb(198,219,239)", "rgb(8,81,156)"]);

                            console.log(countries);
                            
                            countries.attr("fill", function(feature) {
                                var matches = latestData.filter(function(d) {
                                    return d["Alpha-3"] == feature.id;
                                });
                                console.log(matches);
                                if (matches.length > 0) {
                                    return colorScale(matches[0].buddhism_all);
                                }
                                else {
                                    return "rgb(200, 200, 200)";
                                }
                            })
                        });
                        
        // On click for Others
                        d3.select(".C5").on("click", function() {
                            var domain = d3.extent(latestData, function(d) {
                                return d.otherreligion_all;
                            });
                            var colorScale = d3.scaleLinear()
                                .domain(domain)
                                .range(["rgb(218,218,235)", "rgb(84,39,143)"]);

                            console.log(countries);
                            
                            countries.attr("fill", function(feature) {
                                var matches = latestData.filter(function(d) {
                                    return d["Alpha-3"] == feature.id;
                                });
                                console.log(matches);
                                if (matches.length > 0) {
                                    return colorScale(matches[0].otherreligion_all);
                                }
                                else {
                                    return "rgb(200, 200, 200)";
                                }
                            })
                        });

        // On click for None
                        d3.select(".C6").on("click", function() {
                            colorCountries("noreligion_all");
                        });

                        function colorCountries(religion) {
                            var domain = d3.extent(latestData, function(d) {
                                return d[religion];
                            });
                            var colorScale = d3.scaleLinear()
                                .domain(domain)
                                .range(["rgb(254,227,145)", "rgb(217,95,14)"]);

                            console.log(countries);
                            
                            countries.attr("fill", function(feature) {
                                var matches = latestData.filter(function(d) {
                                    return d["Alpha-3"] == feature.id;
                                });
                                console.log(matches);
                                if (matches.length > 0) {
                                    return colorScale(matches[0][religion]);
                                }
                                else {
                                    return "rgb(200, 200, 200)";
                                }
                            })
                        }
                        
                    });
            </script>
                
    </body>

</html>